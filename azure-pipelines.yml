# azure-pipelines.yml
# Purpose: Build a Docker image, scan with Trivy, and publish vulnerability report

trigger:
- main   # Change this to your branch name if needed (e.g., 'master' or 'dev')

pool:
  vmImage: 'ubuntu-latest'  # Uses Azure-hosted Ubuntu agent

steps:
# -------------------------------
# Step 1: Check Docker version
# -------------------------------
- script: docker --version
  displayName: "Verify Docker Installation"

# -------------------------------
# Step 2: Install Trivy
# -------------------------------
- script: |
    sudo apt-get update
    sudo apt-get install -y wget apt-transport-https gnupg lsb-release
    wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
    echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/trivy.list
    sudo apt-get update
    sudo apt-get install -y trivy
  displayName: "Install Trivy Vulnerability Scanner"